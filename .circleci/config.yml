version: 2
  build:
    docker:
      - image: lasote/conangcc7
    steps:
      - checkout
      - run:
          name: Update conan
          command: 'sudo pip install conan --upgrade'

      - restore_cache:
          keys:
            - conan-cache-v1--{{ checksum "conanfile.py" }}
            - conan-cache-v1

      - run:
          name: Conan create
          command: 'conan create . FMI4cpp/testing'

      - save_cache:
          paths:
            - ~/.conan
          key: conan-cache-v1--{{ checksum "conanfile.py" }}

      - run:
          name: Conan install
          command: 'cd test_package && conan install . -s build_type=Debug -s compiler.libcxx=libstdc++11 --install-folder=build --build FMI4cpp'
